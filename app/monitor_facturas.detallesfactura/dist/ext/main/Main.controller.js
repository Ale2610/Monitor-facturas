sap.ui.define(["sap/fe/core/PageController","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("monitorfacturas.detallesfactura.ext.main.Main",{onDetallePress:function(e){var t=e.getSource();var o=t.getParent();var n=o.getBindingContext();var r=n.getProperty("NumeroFactura");console.log(r);var a="#monitorfacturasdetallesfactura-display&/Facturas('"+r+"')";window.open(a,"_blank")},formatter:{estadoToState:function(e){if(e==="Aprobado"){return"Success"}else if(e==="Rechazado"){return"Error"}else{return"Warning"}},urgenteToState:function(e){return e?"Error":"Success"},urgenteToText:function(e){return e?"S√≠":"No"}},timeUTC:function(){var e=new Date;var t=new Date(e.getTime()-e.getTimezoneOffset()*6e4);t.setHours(t.getHours()+5);console.log(t.toISOString());return t.toISOString()},createdNonce:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;const o=e==="x"?t:t&3|8;return o.toString(16)});console.log(e);var t=btoa(e);return t},getInvoicesList:async function(){var e=this.timeUTC();var o=this.createdNonce();try{const n=await fetch("/service/Monitor_FacturasService/consultar_documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noce:o,created:e})});const r=await n.text();console.log("Respuesta SOAP:",r);const a=r.match(/<availableDocument>[\s\S]*?<\/availableDocument>/g);const c=[];if(a&&a.length>0){a.forEach(e=>{const t=e.match(/<documentNumber>(.*?)<\/documentNumber>/)?.[1]||"";const o=e.match(/<documentPrefix>(.*?)<\/documentPrefix>/)?.[1]||"";const n=e.match(/<documentType>(.*?)<\/documentType>/)?.[1]||"";const r=e.match(/<senderIdentification>(.*?)<\/senderIdentification>/)?.[1]||"";c.push({documentNumber:t,documentPrefix:o,documentType:n,senderIdentification:r})})}console.log("üìã Documentos extra√≠dos:",c);t.show(`Consulta realizada. ${c.length} documentos disponibles.`);return c}catch(e){console.error("Error al consultar:",e);t.show("Error en consulta SOAP");return[]}},getDocuments:async function(){var e=await this.getInvoicesList();for(const n of e){var t=this.timeUTC();var o=this.createdNonce();console.log("N√∫mero de documento:",n.documentNumber);console.log("Prefijo de documento:",n.documentPrefix);console.log("Tipo de documento:",n.documentType);console.log("Identificaci√≥n del remitente:",n.senderIdentification);try{const e=await fetch("/service/Monitor_FacturasService/extraer_documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noce:o,created:t,data:"SIGNED_XML",documentNumber:n.documentNumber,documentPrefix:n.documentPrefix,documentType:n.documentType,senderIdentification:n.senderIdentification})});const r=await e.text();console.log("Respuesta SOAP:",r)}catch(e){console.error("‚ùå Error al extraer documentos:",e)}}},onBuscarFactura:function(e){const t=e.getParameter("query");this._aplicarFiltros(t)},onFiltrarEstadoUrgente:function(){const e=this.byId("searchFactura").getValue();this._aplicarFiltros(e)},_aplicarFiltros:function(e){const t=this.byId("filtroEstado").getSelectedKey();const o=this.byId("filtroUrgente").getSelectedKey();const n=[];if(e){n.push(new sap.ui.model.Filter("NumeroFactura",sap.ui.model.FilterOperator.Contains,e))}if(t){n.push(new sap.ui.model.Filter("Estado",sap.ui.model.FilterOperator.EQ,t))}if(o){n.push(new sap.ui.model.Filter("Urgente",sap.ui.model.FilterOperator.EQ,o))}const r=this.byId("FacturaList");const a=r.getBinding("items");if(a){a.filter(n)}else{console.warn("No se encontr√≥ el binding de la lista")}}})});
//# sourceMappingURL=Main.controller.js.map