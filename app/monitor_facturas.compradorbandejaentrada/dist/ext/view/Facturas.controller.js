sap.ui.define(["sap/fe/core/PageController"],function(e){"use strict";return e.extend("monitorfacturas.compradorbandejaentrada.ext.view.Facturas",{onAfterRendering:function(){console.log("✔️ onAfterRendering ejecutado");setTimeout(()=>{this.mostrarPdfEnIframe()},500);const e=new sap.ui.model.json.JSONModel({modoEdicion:false});this.getView().setModel(e,"view")},mostrarPdfEnIframe:function(){const e=this.byId("pdfEmbed");const t=this.getView().getBindingContext();if(!t){console.error("No hay contexto de factura");return}const o=t.getProperty("NumeroFactura");const r=this.getOwnerComponent().getModel();const a=r.sServiceUrl;const n=a+"/Facturas('"+o+"')/archivoPDF/$value";const s=`\n                    <iframe\n                        src="${n}"\n                        width="100%"\n                        height="800px"\n                        style="border: none;"\n                    ></iframe>\n                `;e.setContent(s)},editarFactura:function(){const e=this.getView().getBindingContext();if(!e){console.error("No hay contexto de factura");return}const t={Estado:e.getProperty("Estado"),Urgente:e.getProperty("Urgente"),Descuento:e.getProperty("Descuento"),Comentario:e.getProperty("Comentario"),FechaFactura:e.getProperty("FechaFactura"),FechaContabilizacion:e.getProperty("FechaContabilizacion"),FechaVencimiento:e.getProperty("FechaVencimiento"),FechaRecepcion:e.getProperty("FechaRecepcion"),FormaPago:e.getProperty("FormaPago"),CodigoActividad:e.getProperty("CodigoActividad"),Clasificacion:e.getProperty("Clasificacion"),Area:e.getProperty("Area"),Sede:e.getProperty("Sede"),DocumentoMIRO:e.getProperty("DocumentoMIRO"),DocumentoFI:e.getProperty("DocumentoFI")};this.getView().getModel("view").setProperty("/datosOriginales",t);this.getView().getModel("view").setProperty("/modoEdicion",true)},onGuardar:function(){const e=this.getView();const t=e.getModel();const o=e.getBindingContext();const r=e.getModel("view").getProperty("/datosOriginales");let a=false;Object.entries(r).forEach(([e,t])=>{const r=o.getProperty(e);if(r!==t){a=true}});if(!a){sap.m.MessageToast.show("No hay cambios para guardar.");return}t.submitBatch("$auto").then(()=>{e.getModel("view").setProperty("/modoEdicion",false);e.getModel("view").setProperty("/datosOriginales",null);sap.m.MessageToast.show("Cambios guardados correctamente.")}).catch(e=>{console.error("Error al guardar cambios:",e);sap.m.MessageBox.error("Error al guardar los cambios.")})},onCancelar:function(){const e=this.getView();const t=e.getBindingContext();const o=e.getModel("view").getProperty("/datosOriginales");if(!t||!o){sap.m.MessageToast.show("No se pueden restaurar los datos.");return}Object.entries(o).forEach(([e,o])=>{t.setProperty(e,o)});e.getModel("view").setProperty("/modoEdicion",false);e.getModel("view").setProperty("/datosOriginales",null);sap.m.MessageToast.show("Cambios descartados.")},onDetallePress:function(e){var t=e.getSource();var o=t.getParent();var r=o.getBindingContext();var a=r.getProperty("NumeroEntrada");var n="#monitorfacturasentradas-display&/Entrada('"+a+"')";window.open(n,"_blank")},onDetallePressOrden:function(e){var t=e.getSource();var o=t.getParent();var r=o.getBindingContext();var a=r.getProperty("NumeroMaterial");var n=this.getView().getModel();var s="NumeroMaterial eq '"+a+"'";n.bindList("/DetalleOrdenCompra",null,null,null,{$filter:s}).requestContexts().then(function(e){if(e.length>0){var t=e[0].getObject();var o=t.ID;var r="#monitorfacturasdetalleorden-display&/DetalleOrdenCompra(ID="+o+",IsActiveEntity=true)";window.open(r,"_blank")}else{MessageToast.show("No se encontró el material.")}}).catch(function(){MessageToast.show("Error al consultar DetalleOrdenCompra.")})}})});
//# sourceMappingURL=Facturas.controller.js.map